# Session Learnings - 2026-02-21

## What was done

- Diagnosed table alignment bug caused by `pretty-table` crate using `str::len()` (byte count) instead of display width for column padding
- Created custom `src/table.rs` module using `unicode-width` for correct Unicode display width calculation
- Added 6 tests covering ASCII, Norwegian characters (Ã¦Ã¸Ã¥), emoji, empty input, and header-only tables
- Migrated `reading.rs` and `review.rs` from `pretty_table::print_table!` macro to `crate::table::print_table` function
- Removed `pretty-table` dependency, added `unicode-width` dependency
- All 118 tests pass, code is clean per `cargo fmt` and `cargo clippy`

## Key decisions

- Replaced `pretty-table` rather than forking/patching it, since the crate is small (6K downloads), unmaintained, and the bug is fundamental to its width calculation approach
- Used `unicode-width` (473M downloads) as the industry-standard solution for terminal display width
- Kept the same visual table style (`+`, `|`, `-`, `=`) to minimize user-facing changes

## Gotchas / surprises

- `pretty-table` uses `str::len()` in three separate places for width calculation â€” both for determining max column width and for computing padding spaces, so the error compounds
- Norwegian characters Ã¦, Ã¸, Ã¥ are 2 bytes in UTF-8 but 1 display column wide; emoji like ðŸ“š are 4 bytes but 2 display columns wide â€” both cases need `unicode-width` to handle correctly

## Open questions

- None
