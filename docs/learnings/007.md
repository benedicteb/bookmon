# Session Learnings - 2026-02-21

## What was done

- Planned and implemented yearly book reading goal feature
- Added `goals: HashMap<i32, u32>` field to `Storage` struct with `#[serde(default)]` for backward compatibility
- Added `set_goal()`, `get_goal()`, `remove_goal()` methods to `Storage`
- Added `SetGoal` CLI command: `bookmon set-goal <target> [--year <year>]`
- Added `PrintGoal` CLI command: `bookmon print-goal [--year <year>]` with progress bar
- Default `bookmon` command now shows current year goal status above currently-reading table
- `PrintStatistics` now shows per-year goal progress inline (with remaining count for current year)
- Wrote 10 new tests covering goal CRUD, backward compatibility, JSON round-trip, and sorted serialization
- Created ADR 0008 documenting the design decisions

## Key decisions

- **Goals in Storage JSON, not config** — Per-year data that travels with the data file, uses same `#[serde(default)]` pattern as `reviews` field
- **Books finished only, not pages** — `total_pages` data quality is unreliable (many unknown/zero values), so page-based goals would be misleading
- **`HashMap<i32, u32>`** — Simple year→target mapping instead of a richer Goal struct. Sufficient for the MVP, extensible later if needed
- **Default command shows goal only when set** — No noise when no goal exists; shows a helpful dashboard when one does

## Gotchas / surprises

- The `#[serde(default)]` pattern makes adding new optional fields to `Storage` completely painless — no migration code needed
- The `print!` vs `println!` distinction matters for the progress bar — needed to print bar and "remaining" text on the same line
- Unicode block characters (`█` and `░`) work well for terminal progress bars across platforms

## Open questions

- Should interactive mode have a "Set reading goal" action? Currently goals are set via CLI command only
- Should `bookmon set-goal 0` remove the goal or set it to zero? Currently it sets to zero (which shows 100% complete)
- Monthly pace tracking (e.g., "you need to read 2.3 books/month to hit your goal") could be a nice addition
